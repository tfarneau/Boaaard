<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Party Player</title>
	<meta name="description" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
	
	<div class="chat">
		<div class="log"></div>
		<form action="#" id="sendMessage">
			<input type="text" id="message" placeholder="Message">
			<input type="submit" value="send">
		</form>
	</div>

	<form action="#" id="joinChat">
		<input type="text" id="pseudo" placeholder="Pseudo">
		<input type="text" id="board_slug" placeholder="Board slug">
		<input type="submit" value="join">
	</form>

  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <script>

  	function showMessage(data){
  		$('.log').append("<p><strong>"+data.pseudo+"</strong> : "+data.message+"<p>");
  	}

  	$('.chat').hide();
  	var socket = io.connect('localhost:3000');
  	var roomid=null;

  	var data = {};

	$('#joinChat').submit(function(e){

		data = {
			pseudo : $('#pseudo').val(),
			slug : $('#board_slug').val()
		}

		var send = {
			message : "just connected",
			pseudo : data.pseudo,
			slug : data.slug
		}

		socket.emit('connectToChat',send);
		e.preventDefault();
		
		return false;

	});

	$('#sendMessage').submit(function(e){

		var send = {
			message : $('#message').val(),
			pseudo : data.pseudo,
			slug : data.slug
		}

		$('#message').val('');

		socket.emit('sendMessageToChat',send);
		e.preventDefault();
		return false;

	})

	socket.on('oldMessages',function(data){

		console.log("OLDMESSAGE")
		$('#joinChat').hide();
		$('.chat').show();

		for(var i in data.oldmessages){
			showMessage(data.oldmessages[i]);
		}

	});

	socket.on('connectedToChat',function(data){
		console.log('CONNECTED')
		console.log(data)
		showMessage(data);
	});

	socket.on('newMessageToChat',function(data){
		showMessage(data);
	});

  </script>

</body>
</html>