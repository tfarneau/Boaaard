!function(a){a.freebase=function(){var b=function(){function b(b){console.log(b),a("body").append(JSON.stringify(b))}function c(a){try{return JSON.parse(a)}catch(b){return a}}var d={};if("undefined"!=typeof window&&window.screen)d.get=function(d,e){e=e||b,a.get(d,function(a){e(c(a))}).fail(function(a){e(a.statusText||"error")})},d.jsonp=function(d,e){e=e||b,a.getJSON(d,function(a){e(c(a))}).fail(function(a){e(a.statusText||"error")})},d.post=function(d,e,f){f=f||b,a.post(d,e,function(a){f(c(a))}).fail(function(a){f(a.statusText||"error")})};else if("undefined"!=typeof module&&module.exports){var e=require("request");d.get=function(a,b){b=b||console.log,e({uri:a},function(a,d,e){b(c(e))})},d.post=function(a,b,d){d=d||console.log,"object"==typeof b&&(b=JSON.stringify(b)),e({url:"http://api.freebase.com/api/service/mqlread",method:"POST",body:b},function(a,b,e){d(c(e))})}}return"undefined"!=typeof module&&module.exports&&(module.exports=d),d}();if("undefined"!=typeof module&&module.exports)var c=require("./data.js").data,b=require("./http.js");var d=function(){var a={};return a.isarray=function(a){return"[object Array]"==toString.call(a)},a.isobject=function(a){return a===Object(a)},a.flatten=function(b,c,d){return d=d||[],b.forEach(function(b){a.isarray(b)?c?d.push(b):a.flatten(b,c,d):d.push(b)}),d},a.last=function(a){return a[a.length]},a.compact=function(a){return a.filter(function(a){return a})},a.compact_strong=function(a){return a.filter(function(a){return!a||"object"==typeof a&&0==Object.keys(a).length?!1:!0})},a.settle_params=function(b,c,d){var e={valid:!1,q:b[0],options:b[1]||{},callback:b[2]||console.log,defaults:d||{},method:c||""};if("function"==typeof e.options&&(e.callback=e.options,e.options={}),e.options.verbose){var f=e.callback;e.callback=function(a){return f(a)}}if(a.isarray(e.q)){if(e.q.length>1)return e.q=a.compact_strong(e.q),e.valid=!0,e.array=!0,e;e.q=e.q[0]}if(e.q&&"object"==typeof e.q&&(e.q=e.q.id||e.q.mid||e.q.name),"string"!=typeof e.q||"object"!=typeof e.options||"function"!=typeof e.callback)return e;e.q.match(/\/.*?\/.*?/)&&(e.is_id=!0);for(var g in e.defaults)e.options[g]=e.options[g]||e.defaults[g];return e.q=e.q.replace(/  /," "),e.q=e.q.replace(/^\s+|\s+$/,""),e.q.match(/^(https?:\/\/|www\.)/)&&(e.q=e.q.replace(/\/$/,""),e.q=e.q.replace(/^https/,"http"),e.url=!0),e.valid=!0,e},a.topk=function(a,b){var c=[];b=b||1;for(var d,e={},d=a.length-1;d>-1;d--){var f=a[d];null==e[f]?e[f]=1:e[f]++}for(var f in e)c.push(f);return c.sort(function(a,b){return e[b]-e[a]}).map(function(a){return{value:a,count:e[a],percentage:(e[a]/b*100).toFixed(2)}})},a.percentage=function(a,b){return parseInt(a/b*100)},a.kill_boring=function(a){return a?(c.boring.forEach(function(b){delete a[b]}),a):{}},a.parse_topic_api=function(b){var c=[];return b=a.kill_boring(b),Object.keys(b).forEach(function(d){var e=b[d];"object"==e.valuetype&&(e.values=e.values.map(function(a){return a.property=d,a}),c=c.concat(e.values)),"compound"==e.valuetype&&e.values.forEach(function(b){b.property=a.kill_boring(b.property),Object.keys(b.property).forEach(function(a){"object"==b.property[a].valuetype&&(b.property[a].values=b.property[a].values.map(function(b){return b.property=[d,a],b}),c=c.concat(b.property[a].values))})})}),c=c.map(function(a){return{name:a.text,id:a.id,property:a.property}}),c=c.map(function(b){return a.isarray(b.property)&&(b.property=b.property.join("")),b})},a.metaschema_lookup=function(b){b=b.toLowerCase(),b=b.replace(/\W(is|was|are|will be|has been)\W/," "),b=b.replace(/  /g," "),b=b.replace(/_/g," "),b=b.replace(/^\s+|\s+$/,"");var d=c.metaschema.filter(function(c){return c.aliases=c.aliases||[],c.id==b||c.name.toLowerCase()==b||a.isin(b,c.aliases)||c.search.replace(/_/g," ")==b})[0];return d=d||{},d.search},a.json_unique=function(a,b){var c=[];a:for(var d=0;d<a.length;d++){for(var e=0;e<c.length;e++)if(c[e]&&a[d]&&c[e][b]==a[d][b])continue a;c[c.length]=a[d]}return c},a.doit_async=function(a){a.q=a.q||[];var b=a.q.map(function(b){return{q:b,options:a.options,method:a.method}}),c=[];b.forEach(function(d){d.method(d.q,d.options,function(d){c.push(d),c.length==b.length&&a.callback(c)})})},a.mql_unencode=function(a){return a=a.replace(/\$([0-9A-Fa-f]{4})/g,function(a,b){return String.fromCharCode(parseInt(b,16))})},a.groups_of=function(a,b){var c=[];for(var d in a)d%b===0?c.push([a[d]]):c[c.length-1].push(a[d]);return c},a.parseurl=function(a){for(var b={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;e--;)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d},a.set_params=function(b){var c=b;return c?Object.keys(c).map(function(b){var d=c[b];return(a.isarray(c[b])||a.isobject(c[b]))&&(d=encodeURIComponent(JSON.stringify(c[b]))),b+"="+d}).join("&"):""},a.clone=function(a){return JSON.parse(JSON.stringify(a))},a.softget=function(a,c,d){b.get(a,function(a){d(a)})},a.http=function(a,c,d){c.key&&(a.match(/\?/)||(a+="?"),a+="&key="+c.key),b.get(a,d)},a.post=function(a,c,d){var e="query="+JSON.stringify({query:a,key:c.key,cursor:c.cursor});b.post("https://www.googleapis.com/freebase/v1/mqlread",e,d)},a.isin=function(a,b){return b.some(function(b){return b==a})},a.intersection=function(b,c){return b.filter(function(b){return a.isin(b,c)})},a.isempty=function(a){return a&&"object"==typeof a?"[object Array]"!==Object.prototype.toString.call(a)&&0==Object.keys(a).length?!0:!1:!0},"undefined"!=typeof module&&module.exports&&(module.exports=a),a}();if("undefined"!=typeof module&&module.exports)var d=require("./helpers/helpers");var e=function(){var a={};a.access_token="",a.globals={host:"https://www.googleapis.com/freebase/v1/",image_host:"https://www.googleapis.com/freebase/v1/image",geosearch:"http://api.freebase.com/api/service/geosearch",wikipedia_host:"http://en.wikipedia.org/w/api.php",generic_query:{id:null,name:null,mid:null,type:[]}},a.mqlread=function(b,c,e){if(this.doc="interface to freebase's mql api",this.reference="http://wiki.freebase.com/wiki/MQL",e=e||console.log,!b)return e({});"function"==typeof c&&(e=c,c={}),c=c||{},c.uniqueness_failure=c.uniqueness_failure||"soft",c.cursor=c.cursor||"";var f=a.globals.host+"mqlread?query="+JSON.stringify(b)+"&cursor="+c.cursor;d.http(f,c,function(a){return a&&a.error&&console.log(JSON.stringify(a.error,null,2)),e(a)})},a.search=function(){this.doc="regular search api",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var b=d.settle_params(arguments,a.search,{});if(b.array)return d.doit_async(b);if(!b.valid)return b.callback({});if(b.is_id)return a.lookup_id(b.q,b.options,function(a){b.callback([a])});if(b.url)return a.url_lookup(b.q,b.options,function(a){return b.callback(a&&a.result&&a.result[0]?a.result:[])});if(b.is_id)return b.options.limit=1,a.lookup_id(b.q,b.options,b.callback);b.options.query=encodeURIComponent(b.q),delete b.options.property,delete b.options.strict;var c=d.set_params(b.options),e=a.globals.host+"search/?"+c;("/type/type"==b.options.type||"/type/property"==b.options.type)&&(e+="&scoring=schema&stemmed=true"),d.http(e,b.options,function(a){return a&&a.result&&a.result[0]?b.callback(a.result):(a&&a.error&&console.log(JSON.stringify(a.error,null,2)),b.callback([]))})},a.lookup=function(){this.doc="freebase search with filters to ensure only a confident, unambiguous result",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var b=d.settle_params(arguments,a.lookup,{type:"/common/topic",strict:!0});if(b.array)return d.doit_async(b);if(!b.valid)return b.callback({});if(b.url)return a.url_lookup(b.q,b.options,b.callback);if(b.is_id)return b.options.limit=1,a.lookup_id(b.q,b.options,b.callback);var c=b.options.strength||"full";b.options.strict||(c="word");var e=a.globals.host+"search?limit=2&lang=en&type="+b.options.type+"&filter=",f=d.clone(a.globals.generic_query);return e+=encodeURIComponent("(any name{"+c+'}:"'+b.q+'" alias{'+c+'}:"'+b.q+'")'),("/type/type"==b.options.type||"/type/property"==b.options.type)&&(e+="&scoring=schema&stemmed=true"),e+="&mql_output="+encodeURIComponent(JSON.stringify(f)),d.http(e,b.options,function(a){return a&&a.result&&a.result[0]?(a=a.result||[],a[0]=a[0]||{},a[1]=a[1]||{},!a[0].score&&a[0].score<30?b.callback({}):b.options.strict&&.7*(a[0].score||0)<(a[1].score||0)?b.callback({}):(kill_list=["/music/track","/music/release_track","/tv/tv_episode","/music/recording","/music/composition","/book/book_edition"],a[1]&&a[0].notable&&d.isin(a[0].notable.id,kill_list)?b.callback({}):(a[0].name=a[0].name||a[0].text||"",b.callback(a[0])))):b.callback({})})},a.lookup_id=function(b,c){this.doc="generic info for an id";var e=d.settle_params(arguments,a.lookup,{type:"/common/topic"});if(e.array)return d.doit_async(e);if(!e.valid)return e.callback({});var f=d.clone(a.globals.generic_query);f.id=e.q,a.mqlread([f],c,function(a){return a=a.result||[],e.callback(a[0]||{})})},a.url_lookup=function(){this.doc="freebase search tuned for looking up a url",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var b=d.settle_params(arguments,a.url_lookup,{type:"/common/topic",strict:!0});if(b.array)return d.doit_async(b);if(!b.valid)return b.callback({});var c=d.clone(a.globals.generic_query),e=a.globals.host+"search?type=/common/topic&limit=1&query="+encodeURIComponent(b.q);e+="&mql_output="+encodeURIComponent(JSON.stringify(c)),d.http(e,b.options,function(a){if(!a||!a.result)return b.callback({});var c=a.result||[];return b.callback(c[0])})},a.get_id=function(){this.doc="like freebase.lookup but satisfied with an id",this.reference="http://wiki.freebase.com/wiki/ApiSearch";var b=d.settle_params(arguments,a.get_id,{type:"/common/topic"});return b.array?d.doit_async(b):b.valid?b.q&&null==b.q.match(/\/.{1,32}\/.{3}/)?void a.lookup(b.q,b.options,function(a){return a?"/type/type"==b.options.type?(a.mid=a.id,b.callback(a)):a.mid?(a.id=a.id||a.mid,b.callback(a)):b.callback({}):b.callback({})}):b.callback({id:b.q}):b.callback({})},a.topic=function(){this.doc="topic api",this.reference="http://wiki.freebase.com/wiki/Topic_API";var b=d.settle_params(arguments,a.topic,{});return b.array?d.doit_async(b):b.valid?void a.get_id(b.q,b.options,function(c){var e=c.id;if(!e)return b.callback({});b.options.filter=b.options.filter||"all";var f=a.globals.host+"topic"+e+"?"+d.set_params(b.options);d.http(f,b.options,function(a){return b.callback(a)})}):b.callback({})},a.paginate=function(b,c,d){this.doc="get all of the results to your query",this.reference="http://wiki.freebase.com/wiki/MQL","function"==typeof c&&(d=c,c={}),c=c||{},d=d||console.log,c.max=c.max||99999999;var e=[],f=function(g){c.cursor=g||"",a.mqlread(b,c,function(a){return a&&a.result?(e=e.concat(a.result),a.cursor&&(!c.max||e.length<c.max)?void f(a.cursor):d(e)):d(e)})};f("")},a.wikipedia_page=function(){this.doc="get a url for wikipedia based on this topic";var b=d.settle_params(arguments,a.wikipedia,{});return b.array?d.doit_async(b):b.valid?void a.get_id(b.q,b.options,function(c){if(!c||!c.id)return b.callback("");var e=[{id:c.id,name:null,key:{namespace:"/wikipedia/en_title",value:null}}];a.mqlread(e,b.options,function(a){return b.callback(a&&a.result&&a.result[0]?"http://en.wikipedia.org/wiki/"+d.mql_unencode(a.result[0].key.value):"")})}):b.callback({})},a.dbpedia_page=function(){this.doc="get a url for dbpedia based on this topic";var b=d.settle_params(arguments,a.dbpedia,{});return b.array?d.doit_async(b):b.valid?void a.get_id(b.q,b.options,function(c){if(!c||!c.id)return b.callback("");var e=[{id:c.id,name:null,key:{namespace:"/wikipedia/en_title",value:null}}];a.mqlread(e,b.options,function(a){if(!a||!a.result||!a.result[0])return b.callback({});var c=d.mql_unencode(a.result[0].key.value),e={html:"http://dbpedia.org/page/"+c,json:"http://dbpedia.org/data/"+c+".json"};return b.callback(e)})}):b.callback({})},a.mql_encode=function(a){if(this.doc="quote a unicode string to turn it into a valid mql /type/key/value",!a)return"";a=a.replace(/  /," "),a=a.replace(/^\s+|\s+$/,""),a=a.replace(/ /g,"_");var b="A-Za-z0-9",c="A-Za-z0-9_-",d=new RegExp("^["+b+"]["+c+"]*$"),e=new RegExp("([^"+c+"])","g");if(d.exec(a))return a;var f=function(a,b){var c=b.charCodeAt(0).toString(16).toUpperCase();return 2==c.length&&(c="00"+c),3==c.length&&(c="0"+c),"$"+c},g=a.replace(e,f);return("-"==g.charAt(0)||"_"==g.charAt(0))&&(g=f(g,g.charAt(0))+g.substr(1)),g},a.rdf=function(){this.doc="RDF api",this.reference="http://wiki.freebase.com/wiki/RDF";var b=d.settle_params(arguments,a.topic,{});return b.array?d.doit_async(b):b.valid?void a.get_id(b.q,b.options,function(c){var e=c.id;if(!e)return b.callback({});b.options.filter=b.options.filter||"all";var f=a.globals.host+"rdf"+e;d.softget(f,b.options,function(a){return b.callback(a||"")})}):b.callback({})},a.description=function(){this.doc="get a text blurb from freebase",this.reference="http://wiki.freebase.com/wiki/ApiText";var b=d.settle_params(arguments,a.description,{});return b.array?d.doit_async(b):b.valid?void a.get_id(b.q,b.options,function(c){if(!c||!c.id)return b.callback("");var e=a.globals.host+"text"+c.id;d.http(e,b.options,function(a){return b.callback(a.result?a.result:"")})}):b.callback({})},a.image=function(){this.doc="get a url for image href of on this topic",this.reference="http://wiki.freebase.com/wiki/ApiImage";var b=d.settle_params(arguments,a.image,{maxheight:250,maxwidth:250,errorid:"/m/0djw4wd"});return b.array?d.doit_async(b):b.valid?void a.get_id(b.q,b.options,function(c){if(!c||!c.id)return b.callback("");var e=[{id:c.id,name:null,"/common/topic/image":[{id:null}]}];a.mqlread(e,b.options,function(c){if(!(c&&c.result&&c.result[0]&&c.result[0]["/common/topic/image"][0]))return b.callback("");var e=a.globals.image_host+c.result[0]["/common/topic/image"][0].id;delete b.options.strict,delete b.options.cursor,delete b.options.uniqueness_failure;var f=d.set_params(b.options);return e+="?"+f,b.callback(e)})}):b.callback({})},a.notable=function(){this.doc="get a topic's notable type";var b=d.settle_params(arguments,a.notable,{});return b.array?d.doit_async(b):b.valid?void a.topic(b.q,{filter:"/common/topic/notable_types"},function(a){if(!a||!a.property||!a.property["/common/topic/notable_types"])return b.callback({});var c=a.property["/common/topic/notable_types"]||{values:[]};return c.values[0].name=c.values[0].text,b.callback(c.values[0])}):b.callback({})},a.documentation=function(){Object.keys(a).filter(function(a){return"documentation"!=a&&"access_token"!=a&&"test_writes"!=a&&"globals"!=a}).forEach(function(b){var c=new a[b]("",{},function(){});console.log("* **"+b+"**\n     -"+c.doc)})};var b={mqlread:["query","mql_read"],topic:["topic_api","all_data","data","everything","get_data"],paginate:["continue","all","each"],same_as_links:["sameas","sameaslinks","links","external_links","weblinks"],translate:["translate_to","i8n","translation"],image:["picture","get_image"],description:["blurb","get_blurb","blurb_api","text"],notable:["notable_type","notable_for","notable_as","main_type","type"],place_data:["place","place_info","location_info","location"],incoming:["incoming_links"],outgoing:["outgoing_links"],related:["related_topics","similar"],geolocation:["geo","geocoordinates","geo_location","lat_lng","location"],nearby:["near","close_to"],inside:["inside_of","within","contained_by","contains"],mql_encode:["encode","escape"]};return Object.keys(b).forEach(function(c){a[c]&&b[c].forEach(function(b){a[b]=a[c]})}),"undefined"!=typeof module&&module.exports&&(module.exports=a),a}();return e}()}(jQuery);